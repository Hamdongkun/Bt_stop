<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Buttle - 메인페이지</title>
  <link rel="stylesheet" href="/css/cart.css" />
</head>
<body>

<!-- 상단 navbar -->
<div class="navbar">
  <a href="/" class="logo-text">Buttle</a>
  <a href="/search" class="search-button">🔍 검색 페이지로 가기</a>
</div>

<!-- 장바구니 박스 -->
<div class="box">
  <h2 class="title-text">장바구니</h2>

  <!-- 장바구니 비어있을 때 -->
  <div th:if="${#lists.isEmpty(cartItems)}">
    <p>장바구니가 비어있습니다.</p>
  </div>

  <!-- 장바구니 아이템 테이블 -->
  <div th:unless="${#lists.isEmpty(cartItems)}">
    <!-- 전체 삭제 버튼 -->
    <form action="/cart/clear" method="post">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="submit" class="all-delete">장바구니 비우기</button>
    </form>

    <table class="cart-items-table">
      <thead>
      <tr>
        <th>상품명</th>
        <th>단가</th>
        <th>수량</th>
        <th>합계</th>
        <th>수정</th>
        <th>삭제</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="item : ${cartItems}">
        <td th:text="${item.productName}">상품명</td>
        <td th:text="${item.unitPrice} + '원'">단가</td>
        <td th:text="${item.quantity}">수량</td>
        <td th:text="${item.linePrice} + '원'">합계</td>
        <td>
          <!-- 수량 증가 버튼 -->
          <form action="/cart/increase" method="post" style="display:inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input type="hidden" name="productId" th:value="${item.productId}" />
            <button type="submit">➕</button>
          </form>

          <!-- 수량 감소 버튼 -->
          <form action="/cart/decrease" method="post" style="display:inline;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input type="hidden" name="productId" th:value="${item.productId}" />
            <button type="submit">➖</button>
          </form>
        </td>
        <td>
          <!-- 삭제 버튼 -->
          <form action="/cart/delete" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input type="hidden" name="productId" th:value="${item.productId}" />
            <button type="submit">🗑️ 삭제</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>

    <!-- 총합 -->
    <hr class="line2"/>
    <h3 class="price-text-title">총 결제 금액</h3>
    <div class="price-text" th:text="${totalPrice} + '원'">0원</div>

    <!-- 주문하기 버튼 -->
    <a href="/payment" class="payment-rectangle" style="display: block; text-align: center; text-decoration: none;">
      주문하기
    </a>

  </div>
</div>

</body>
</html>
